___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.



___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Xandr config",
  "categories": ["ANALYTICS", "ADVERTISING", "MARKETING", "REMARKETING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Unofficial template to add Xandr script to site\nBest used with the Xandr Event template",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "UNIVERSAL_PIXEL_UUID",
    "displayName": "Your universal pixel id",
    "simpleValueType": true,
    "notSetText": "Your Pixel Id must be set",
    "help": "The universal pixel id is the idyou generated during the universal pixel creation, it looks something like this \u0027a58fde5b-f991-474f-\n9456-b2509ba30042\u0027"
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Log debug messages to console",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const copyFromWindow = require('copyFromWindow');
const createQueue = require('createQueue');
const setInWindow = require('setInWindow');
const injectScript = require('injectScript');
const log = data.debug ? logToConsole : () => {};
const tracking_id = data.UNIVERSAL_PIXEL_UUID;

const onSuccess = () => {
  log('Xandr: Pixie script loaded');
  data.gtmOnSuccess();
};

const onFailure = () => {
  log('Xandr: Pixie script failed.');
  data.gtmOnFailure();
};

let pixie = copyFromWindow('pixie');
    if(!pixie){
      log("Xandr config: script not loaded, loading");      
      let pQ;
      setInWindow('pixie', (e, i, a) => {
        pQ({ action: e, actionValue: i, params: a });
      });
      pQ = createQueue('pixie.actionQueue'); }


pixie = copyFromWindow('pixie');
pixie('init', tracking_id);
pixie('event', 'PageView');

const url = 'https://acdn.adnxs.com/dmp/up/pixie.js';
injectScript(url, onSuccess, onFailure, url);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://acdn.adnxs.com/dmp/up/pixie.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pixie"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "pixie.actionQueue"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/09/2020, 10:12:40


